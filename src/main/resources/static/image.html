<!DOCTYPE html>
<html>
<head>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes"/>
    <meta charset="UTF-8">
    <title>网页标题</title>
    <script type="text/javascript" src="/js/vue.js"></script>
    <script type="text/javascript" src="/js/axios.min.js"></script>
    <script type="text/javascript" src="/js/queryString.js"></script>
    <script type="text/javascript">

    </script>
    <style type="text/css">
        .err {
            color: red;
        }

        input {
            width: 100px;
        }
    </style>
    <style type="text/css">
        .err {
            color: red;
        }

        input {
            width: 70%;
        }

        .customers {
            font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
            width: 100%;
            border-collapse: collapse;

        }

        .customers td, #customers th {
            font-size: 1em;
            border: 1px solid #98bf21;
            padding: 3px 7px 2px 7px;
        }

        .customers th {
            font-size: 1.1em;
            text-align: left;
            padding-top: 5px;
            padding-bottom: 4px;
            background-color: #A7C942;
            color: #ffffff;
        }

        .customers tr.alt td {
            color: #000000;
            background-color: #EAF2D3;
        }
    </style>
</head>
<body>
<div id="app">
    <div style="position: fixed">
        <select v-model="param.f">
            <option>测试版面</option>
            <option>少女前线</option>
        </select><br>
        <select v-model="param.t">
            <option>测试楼</option>
            <option>少前水楼</option>
        </select><br>

        <select v-model="selected" size="5" multiple="multiple" @change="getNames()">
            <option v-for="(item,i) in fileUrls" :value="i" :id="item.name"
                    @click.prevent.right="addFile(i)">
                {{item.name}}
            </option>
        </select>


        <br><br>
        <button @click="selectAll()">全选</button>
        <button @click="repost()">转发</button>
        <br>
        <button @click="archive()">归档</button>
        <br><br><br>
        <button @click="del()">删除</button>

    </div>
    <a :href="getPath(0)"><img :src="getPath(0)" style="width: 100%"></a>
</div>
</body>
<script>
    const app = new Vue({
        el: "#app",
        data: {
            param: {
                name: [],
                f: "测试版面",
                t: "测试楼",
            },
            fileUrls: [{name:1,path:1}],
            nga: {},
            selected: [0],
            pid: "",
            selectedKey: "",
            pidArray: [],

        },
        methods: {
            getFileUrls() {
                get("/data/getFilesPath", null, function (res) {
                    _this.fileUrls = res.data;

                })
            },
            getInfo() {
                post("nga/getInfo", null, function (res) {
                    this.nga = res.data;
                    console.log(res.data);
                })
            },
            repost() {
                if (this.param.name.length === 0) {
                    alert("作品数不能为0");
                    return;
                }

                let url = "nga/repost?" + qs(this.param);

                // console.log(url)
                window.open(url);
            },
            archive() {
                let url = "pixiv/archive?";
                post(url, this.param, function (res) {
                    console.log(res.data);
                    let name = _this.param.name;
                    for (let i = 0; i < name.length; i++) {
                        _this.fileUrls.splice(name[i],1);
                    }
                })
            },
            selectAll(){
                this.selected = [];
                for (let i = 0; i < this.fileUrls.length; i++) {
                    this.selected[this.selected.length] =i;
                }
            },

            del(){
                post("data/delFile",this.param, function (res) {
                    console.log(res.data);
                    let name = _this.param.name;
                    for (let i = 0; i < name.length; i++) {
                        _this.fileUrls.splice(name[i],1);
                    }
                    _this.selected = [0];
                })
            },
            getPath(i){
                return this.fileUrls[this.selected[i]].path;
            },
            getNames(){
                this.param.name = [];
                for (let i = 0; i < this.selected.length; i++) {
                    let index = this.selected[i];
                    this.param.name [this.param.name .length] = this.fileUrls[index].name;
                }
                console.log(this.param.name);;
            },
        },
        created() {
            this.getFileUrls();
            this.getInfo();
        },
    });
    const _this = app;
</script>
</html>

